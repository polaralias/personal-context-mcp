version: '3.8'

services:
  app:
    container_name: personal-context-mcp
    build: .
    ports:
      - "3010:3000"
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/mcp
      - GOOGLE_API_KEY=dummy
      - GOOGLE_POLL_CRON=0 0 * * *
      # MASTER_KEY: 64 hex characters (32 bytes) or a strong passphrase.
      # Generate with: openssl rand -hex 32
      - MASTER_KEY=insecure-master-key-must-be-32-bytes-long
      # REDIRECT_URI_ALLOWLIST: Comma-separated list of allowed redirect URIs.
      # Default prefixes for ChatGPT, OpenAI, and local development.
      - REDIRECT_URI_ALLOWLIST=https://chatgpt.com/,https://chat.openai.com/,http://localhost:3010/,http://localhost:3000/
      # Optional: Set mode to 'exact' or 'prefix' (default)
      - REDIRECT_URI_ALLOWLIST_MODE=prefix
      # API Key Mode: disabled (default), global, or user_bound
      - API_KEY_MODE=disabled
      # Rate Limiting
      - API_KEY_ISSUE_RATELIMIT=3
      - API_KEY_ISSUE_WINDOW_SECONDS=3600
      - MCP_RATELIMIT_PER_KEY=60
      - MCP_RATELIMIT_WINDOW_SECONDS=60
      # Optional TTL overrides
      # - CODE_TTL_SECONDS=300
      # - TOKEN_TTL_SECONDS=3600
      # - TEST_BYPASS_TURNSTILE=true
    depends_on:
      - db

  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=mcp
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
